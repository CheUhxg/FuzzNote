# 一、引言

攻击者需要手动查明释放对象（即漏洞对象）出现的时间帧，以便将数据喷洒到其区域，并据此修改其内容。为了确保操作系统内核的安全执行会受到喷洒数据的影响，他还需要利用自己的专业知识，根据释放对象的大小以及堆分配器的类型，手动调整系统调用和相应的参数。

因为UAF漏洞的利用需要对漏洞对象进行空间和时间控制，在这些约束条件下，微小的上下文变化通常不利于可利用性探索。

FUZE，一个评估内核UAF漏洞可利用性的攻击框架，利用内核fuzzing来探索各种系统调用，从而改变内核panic的上下文。在每个环境下，每一个不同的内核panic，FUZE进一步执行符号执行的目标是追踪潜在的有用的原语利用。

# 二、背景和挑战

> 安全分析人员需要确定*导致悬浮指针出现*以及*解引用该指针*的系统调用

问题1：为什么不考虑free点和use点在同一个系统调用的情况？

堆喷的目标是**接管释放的对象**，从而利用所喷洒的数据将系统的控制流重定向到未经授权的操作，例如权限提升或关键数据泄漏。安全分析人员还需要根据PoC程序的语义仔细计算所喷洒数据的内容，从而**调整**为执行堆喷而选择的系统调用的**参数**。

意外的写原语只给予分析人员将不可管理的数据(即新对象的地址)写入Linux内核中不可管理的堆地址的特权。换句话说，这意味着分析人员不能利用意外的写操作来操作指令指针rip，从而执行控制流劫持，也不能利用它来操作Linux内核中的关键数据，从而实现权限提升。

# 三、概述

由于系统调用sendmsg()具有*解引用双链表中新添加的对象中的数据*的能力，当意外的释放操作发生并出现悬浮指针时，它具有在原始PoC中定义的系统调用之前解引用悬浮指针的能力，从而改变内核panic的方式。

我们提出了一种技术方法来促进PoC程序的上下文变化。我们将它们与下面几节将介绍的其他技术一起命名为FUZE，这是一个利用框架。该框架背后的设计理念是，**上下文变化可以促进识别利用原语**，有了上下文变化，可以潜在地加快制作工作利用，并可以显著升级内核UAF漏洞的可利用性。

> FUZE的最终目标不是 `<u>`自动生成一个可运行利用，而是激发安全分析人员编写一个可运行利用的能力 `</u>`。

问题2：FUZE最终输出不是一个EXP吗？

我们设计了FUZE：首先运行PoC程序，并使用现成的ASAN进行分析。随着动态追踪方法的便利，FUZE可以识别与漏洞对象有关的关键信息，以及连续利用所需的时间窗口。

1. 从技术上讲，我们设计并开发了一种上下文中fuzzing方法，它自动探索 `<u>`确认过的时间窗口内的内核代码空间 `</u>`，从而确定可能导致内核panic的系统调用(和相应的参数)。
2. 一个新的上下文(即新的内核恐慌)不一定能帮助分析人员创建一个有效的漏洞。我们进一步设计了FUZE来自动评估每一个新的上下文。
   - 我们将释放对象的每个字节设置为一个符号值，然后在每个上下文中实施符号执行。
   - 我们**在悬空指针解引用之后**立即执行符号执行。可以防止发生路径爆炸。
