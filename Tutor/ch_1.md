# 第一章 Linux内核简介

## Unix的历史

> 3BSD系统开始支持**虚拟内存**。
> 4BSD系统实现了任务管理、换页机制、TCP/IP等特性。

Unix系统的最终版本是4.4BSD。
* 简洁：仅提供几百个系统调用。
* 统一：所有对象都是文件。
* 可移植：内核和工具都是C编写。
* 进程创建快捷：设计了fork()系统调用。

## Linux简介

Linux是类Unix系统，但它不是Unix。
* 限制条款是General Public License(GPL)，保证个人可以任意获取并修改内核代码，但如果要发布改过的内核，需要保证分享个人所拥有的权利。

Linux系统的基础
* **内核、C库、工具集和系统基本工具**。

## 操作系统和内核简介

操作系统是指在整个系统中负责完成最基本功能和系统管理的那些部分。
* 包括内核、设备驱动程序、启动引导程序、命令行shell/用户界面、文件管理和系统工具。

**内核是操作系统核心**。包括：
* 中断服务程序：响应中断；
* 调度程序：管理多个进程从而分享处理器时间；
* 内存管理程序：管理进程地址空间。
* 服务程序：管理网络、进程间通信等。

保护模式下，内核独立于普通应用程序。
* 内核空间：内核处于**系统态**，拥有**受保护的内存空间和访问硬件设备的权限**。
* 用户空间：应用程序在用户空间运行，只能看到允许它们使用的系统资源。
* 内核运行时，系统以**内核态**进入内核空间执行；执行普通应用时，系统以**用户态**进入用户空间执行。

应用程序通过**系统调用**来与内核通信。
* 系统调用：内核代替应用程序执行。
* 相当于应用程序通过系统调用**陷入内核**。

几乎所有体系结构都提供了**中断机制**。
* 当设备企图和系统通信时，设备首先发出一个**异步的中断信号**来打断处理器的执行，继而打断内核的执行。
* 中断通常对应一个**中断号**，内核通过该中断号查找对应的**中断服务程序**。

处理器的活动可分为三类：
* 运行于用户空间，执行用户进程。
* 运行于内核空间，处于进程上下文，代替某个特定的进程执行。
* 运行于内核空间，处于中断上下文，与进程无关，处理特定中断。

> CPU空闲时，内核在内核空间运行一个空进程，处于进程上下文。

## Linux内核和传统Unix内核的比较

Unix内核是一个不可分割的**静态可执行库**。
* 必须以巨大的可执行块在一个单独的地址空间运行。

Unix内核通过硬件系统提供**页机制(MMU)**来管理内存。
* 该机制可以加强对内存空间的保护：保证每个进程运行于不同的虚地址空间。
* Linux不是所有都有MMU支持。

### 单内核与微内核设计比较

单内核就是把内核从整体上作为一个单独的大过程来实现，其运行在一个单独的地址空间上。
* 因为都运行子内核态，所以没有内核之间的通信，并处于同一地址空间：**内核可以直接调用函数**。
* 简单、性能高。

微内核的功能被分为多个独立的过程，每个过程叫做一个服务器。
* 只有需要特权服务的服务器才在特权模式下，其他服务器都在用户空间中。
* 通过**消息传递**处理微内核通信：系统采用**进程间通信(IPC)机制**。
* **全部的服务器都位于内核**，这样就可以直接调用函数，避免IPC的上下文切换。

Linux是单内核，具有微内核的特点。
* 支持**动态加载内核模块**。
* 支持**对称多处理(SMP)机制**。
* 内核可以**抢占**。
* 内核不区分线程和一般的进程。
* 提供具有设备类的面向对象的设备模型、热插拔事件，以及用户空间的设备文件系统。

## Linux内核版本

kernel版本命名规则
``` 
主版本号.从版本号.修订版本号.稳定版本号
```

> 稳定版本号是可选的，奇数代表是开发版，偶数代表是稳定版。